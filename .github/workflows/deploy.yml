name: Deploy Frontend (ReactJS/NextJS)

on:
  push:
    branches:
      - main  # This will trigger the pipeline on pushes to the 'main' branch

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest  # The environment for the job

    steps:
      # Step 1: Checkout the code from the repository
      - name: Checkout code
        uses: actions/checkout@v2


      # Step 3: Install dependencies
      - name: Install dependencies
        run: |
          npm install  # or `yarn install` if you are using yarn

      # Step 4: Build the project
      - name: Build the project
        run: |
          npm run build  # or `yarn build` if you're using yarn

      # Step 5: Deploy the build to your server (via SCP or rsync)
      - name: Deploy to server (using SCP)
        env:
          DEPLOY_HOST: ${{ secrets.SERVER_HOST }}
          DEPLOY_USER: ${{ secrets.SERVER_USER }}
          DEPLOY_SSH_KEY: ${{ secrets.SERVER_SSH_KEY }}
        run: |
          # Set up SSH for deployment
          mkdir -p ~/.ssh
          echo "$DEPLOY_SSH_KEY" > ~/.ssh/id_rsa
          chmod 600 ~/.ssh/id_rsa
          ssh-keyscan $DEPLOY_HOST >> ~/.ssh/known_hosts

          # Copy the build files to your server (adjust path to server directory)
          scp -r ./out/* $DEPLOY_USER@$DEPLOY_HOST:/path/to/your/frontend/directory